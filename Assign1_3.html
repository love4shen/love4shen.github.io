<!DOCTYPE html>
<html>
<body>
<style>
body {
  margin: 0;
}
canvas {
  width: 100%;
  height: 100%
}
</style>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r72/three.min.js"></script>
  <script>
  var scene = new THREE.Scene();
  var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

  var renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  var geometry = new THREE.SphereGeometry(0.1, 32, 32);
  camera.position.z = 40;

  var numParticles = 12000;
  var genRate = 1200;

  var posArr = new Array(numParticles);
  var velArr = new Array(numParticles);
  var sphereArr = new Array(numParticles);

  for (var i = 0; i < numParticles; i++) {
    sphereArr[i] = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({
      color: 0x000000
    }));
    scene.add(sphereArr[i]);
  }

  a = sphereArr[0];


  var particleIndex = 0;

  var clock = new THREE.Clock();

  var oldTime = clock.getElapsedTime();

  var boundary = [];
  boundary[1] = -20;

  var fireColors = ['0xffffff', '0xE8D6B0', '0xfdcf58', '0xf07f13', '0xf27d0c','0xF53431', '0x800909'];

  var render = function () {
    requestAnimationFrame(render);

    var now = clock.getElapsedTime();
    var interval = now - oldTime;
    oldTime = now;

    spawnParticles(interval);

    for (var i = 0; i < numParticles; i++) {
      if (velArr[i]) {

        var check = Math.floor((sphereArr[i].position.y + 15)*(sphereArr[i].position.y + 15) + sphereArr[i].position.x*sphereArr[i].position.x*20);

        var colorPar = fireColors[Math.floor(check/1600*7)];

        sphereArr[i].material.color.setHex(colorPar);
        sphereArr[i].position.y = posArr[i][1];
        sphereArr[i].position.x = posArr[i][0];

        velArr[i][1] = (Math.random()*2 - 1)*4 + 3;
        posArr[i][1] += velArr[i][1] * interval;


        velArr[i][0] = (Math.random()*2 - 1)*10 - posArr[i][0]/4;
        posArr[i][0] += velArr[i][0] * interval;

      }
    }

    renderer.render(scene, camera);
  };


  var spawnParticles = function (dt) {
    var numTotal = dt * genRate;
    var numInt = Math.floor(numTotal);
    var numFrac = numTotal - numInt;

    if (numFrac > Math.random()) {
      numInt += 1;
    }

    for (var i = 0; i < numInt; i++) {
      particleIndex = particleIndex % numParticles;

      var fireRadius = 7;
      var temp1 = Math.random()*2 - 1;
      var temp2 = Math.random()*2 - 1;
      posArr[particleIndex] = [fireRadius*2*temp1*Math.pow((1- temp1*temp1 - temp2*temp2), 0.5), fireRadius*2*temp2*Math.pow((1- temp1*temp1 - temp2*temp2), 0.5) - 15, fireRadius*(1 - 2*(temp1*temp1 + temp2*temp2))];
      velArr[particleIndex] = [3*(Math.random()*2 - 1), 3*(Math.random()*2 - 1), 3*(Math.random()*2 - 1)];
      particleIndex += 1;
    }
  }

  render();
  </script>
</body>
</html>
